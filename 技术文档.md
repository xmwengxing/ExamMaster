# EduMaster é¡¹ç›®æŠ€æœ¯æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: EduMaster - å…¨æ ˆæ™ºèƒ½åˆ·é¢˜ä¸æ¨¡æ‹Ÿè€ƒè¯•ç³»ç»Ÿ  
**ç‰ˆæœ¬**: 2.0.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-09  
**åŸŸå**: http://jingtianairen.cc  
**æœåŠ¡å™¨**: VPS (23.95.213.28)

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: React 19.2.3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite 6.4.1
- **UI æ¡†æ¶**: Tailwind CSS 3.4.1 (CDN)
- **å›¾æ ‡åº“**: Font Awesome 6.4.2
- **çŠ¶æ€ç®¡ç†**: Zustand 5.0.2
- **æœ¬åœ°å­˜å‚¨**: Dexie 4.0.11 (IndexedDB)
- **å›¾è¡¨åº“**: Recharts 3.6.0
- **Markdown**: Marked 5.1.1
- **å¯Œæ–‡æœ¬ç¼–è¾‘**: Quill 2.0.3

### åç«¯æŠ€æœ¯
- **è¿è¡Œç¯å¢ƒ**: Node.js 20.19.6
- **æ¡†æ¶**: Express 5.2.1
- **æ•°æ®åº“**: SQLite3 5.1.7
- **è®¤è¯**: JWT (jsonwebtoken 9.0.3)
- **å¯†ç åŠ å¯†**: bcryptjs 3.0.3
- **AI é›†æˆ**: 
  - DeepSeek API (æ¨è)
  - OpenAI API
  - Claude API (Anthropic)
  - Gemini API (Google)
  - æ–‡å¿ƒä¸€è¨€ API (ç™¾åº¦)
- **è·¨åŸŸ**: CORS 2.8.5

### éƒ¨ç½²æŠ€æœ¯
- **è¿›ç¨‹ç®¡ç†**: PM2 6.0.14
- **Web æœåŠ¡å™¨**: Nginx
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 64-bit
- **åŸŸåæ‰˜ç®¡**: Cloudflare

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æµè§ˆå™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/HTTPS
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Nginx       â”‚ (ç«¯å£ 80/443)
â”‚  åå‘ä»£ç†æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ é™æ€æ–‡ä»¶ (/var/www/edumaster/dist)
         â”‚
         â””â”€â†’ API è¯·æ±‚ (proxy_pass)
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Express API   â”‚ (ç«¯å£ 3001)
    â”‚   (PM2 ç®¡ç†)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SQLite æ•°æ®åº“  â”‚
    â”‚ edumaster.db    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
/var/www/edumaster/
â”œâ”€â”€ dist/                    # å‰ç«¯æ„å»ºäº§ç‰©
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ server.js                # Express åç«¯æœåŠ¡
â”œâ”€â”€ package.json             # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ ecosystem.config.cjs     # PM2 é…ç½®æ–‡ä»¶
â”œâ”€â”€ edumaster.db             # SQLite æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ out.log             # æ ‡å‡†è¾“å‡ºæ—¥å¿—
â”‚   â””â”€â”€ err.log             # é”™è¯¯æ—¥å¿—
â””â”€â”€ node_modules/            # Node.js ä¾èµ–åŒ…
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—
- **è§’è‰²ç³»ç»Ÿ**: 
  - è¶…çº§ç®¡ç†å‘˜ (ADMIN - phone: 'admin')
  - æ™®é€šç®¡ç†å‘˜ (ADMIN with permissions)
  - å­¦å‘˜ (STUDENT)
- **æƒé™ç®¡ç†**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
  - ç®¡ç†å‘˜æƒé™ï¼šæ•°æ®çœ‹æ¿ã€å­¦å‘˜ç®¡ç†ã€é¢˜åº“ç®¡ç†ã€è€ƒè¯•å‘å¸ƒã€å®æ“å‘å¸ƒã€ç£å­¦ç®¡ç†ã€è®¨è®ºç®¡ç†ã€æ ‡ç­¾ç®¡ç†ã€ç³»ç»Ÿè®¾ç½®
  - å­¦å‘˜æƒé™ï¼šé¢˜åº“è®¿é—®ã€è§†é¢‘è¯¾ç¨‹ã€è€ƒè¯•å‚ä¸
- **è®¤è¯æœºåˆ¶**: JWT Token (7å¤©æœ‰æ•ˆæœŸ)
- **å¯†ç åŠ å¯†**: bcrypt åŠ å¯†å­˜å‚¨ (10è½®)
- **è‡ªå®šä¹‰å­—æ®µ**: æ”¯æŒç®¡ç†å‘˜è‡ªå®šä¹‰å­¦å‘˜ä¿¡æ¯å­—æ®µ

### 2. é¢˜åº“ç®¡ç†æ¨¡å—
- **é¢˜åº“åˆ†ç±»**: æ”¯æŒå¤šçº§åˆ†ç±»å’Œéš¾åº¦ç­‰çº§ï¼ˆåˆçº§ã€ä¸­çº§ã€é«˜çº§ã€ä¸“å®¶ï¼‰
- **é¢˜å‹æ”¯æŒ**: 
  - å•é€‰é¢˜ (SINGLE)
  - å¤šé€‰é¢˜ (MULTIPLE)
  - åˆ¤æ–­é¢˜ (JUDGE)
  - å¡«ç©ºé¢˜ (FILL_IN_BLANK) âœ¨ æ–°å¢
  - ç®€ç­”é¢˜ (SHORT_ANSWER) âœ¨ æ–°å¢
- **é¢˜ç›®å¯¼å…¥**: æ‰¹é‡å¯¼å…¥åŠŸèƒ½ï¼Œæ”¯æŒ CSV æ ¼å¼
- **åˆ†å€¼é…ç½®**: æ¯ä¸ªé¢˜åº“å¯è‡ªå®šä¹‰å„é¢˜å‹åˆ†å€¼
- **é¢˜ç›®æ ‡ç­¾**: æ”¯æŒæ ‡ç­¾åˆ†ç±»å’Œç®¡ç† âœ¨ æ–°å¢
- **é¢˜ç›®å»é‡**: è‡ªåŠ¨æ£€æµ‹é‡å¤é¢˜ç›®

### 3. ç»ƒä¹ æ¨¡å—
- **ç»ƒä¹ æ¨¡å¼**:
  - é¡ºåºç»ƒä¹ 
  - éšæœºç»ƒä¹ ï¼ˆæ··åºç»ƒä¹ ï¼‰
  - é”™é¢˜ç»ƒä¹ 
  - æ”¶è—ç»ƒä¹ 
  - æ™ºèƒ½å¤ä¹ ï¼ˆSRSé—´éš”é‡å¤ç³»ç»Ÿï¼‰âœ¨ æ–°å¢
- **è¿›åº¦ä¿å­˜**: è‡ªåŠ¨ä¿å­˜ç­”é¢˜è¿›åº¦ï¼Œæ”¯æŒç»§ç»­ç»ƒä¹ 
- **ç­”é¢˜è®°å½•**: å®Œæ•´çš„ç­”é¢˜å†å²è®°å½•
- **é¢˜å‹ç­›é€‰**: æ”¯æŒæŒ‰é¢˜å‹ç­›é€‰ç»ƒä¹ 
- **è‡ªå®šä¹‰ç»ƒä¹ **: è‡ªå®šä¹‰é¢˜ç›®æ•°é‡å’Œé¢˜å‹ç»„åˆ

### 4. è€ƒè¯•æ¨¡å—
- **è€ƒè¯•ç­–ç•¥**:
  - éšæœºæŠ½é¢˜
  - æ‰‹åŠ¨é€‰é¢˜
- **è€ƒè¯•é…ç½®**:
  - è€ƒè¯•æ—¶é•¿
  - åŠæ ¼åˆ†æ•°/ç™¾åˆ†æ¯”
  - é¢˜ç›®æ•°é‡é…ç½®ï¼ˆæ”¯æŒ5ç§é¢˜å‹ï¼‰
  - å¯è§æ€§æ§åˆ¶
  - æ—¶é—´èŒƒå›´é™åˆ¶
- **è€ƒè¯•å†å²**: å®Œæ•´çš„è€ƒè¯•è®°å½•å’Œæˆç»©ç»Ÿè®¡
- **æˆç»©åˆ†æ**: é”™é¢˜ç»Ÿè®¡ã€ç”¨æ—¶åˆ†æ

### 5. å®æ“é¢˜æ¨¡å—
- **å¤šéƒ¨åˆ†é¢˜ç›®**: æ”¯æŒå¤æ‚çš„å®æ“é¢˜ç»“æ„
- **AI è¯„ä»·**: é›†æˆå¤šä¸ª AI æœåŠ¡å•†è¿›è¡Œæ™ºèƒ½è¯„ä»·
- **æäº¤è®°å½•**: ä¿å­˜å­¦å‘˜çš„å®æ“ç­”æ¡ˆå’Œå†å²è®°å½•
- **å†å²æŸ¥çœ‹**: æŸ¥çœ‹å†å²æäº¤è®°å½•

### 6. AI åŠŸèƒ½æ¨¡å—
- **å¤šAIæœåŠ¡å•†æ”¯æŒ**: âœ¨ æ–°å¢
  - DeepSeekï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰
  - OpenAI (GPT-4/GPT-3.5)
  - Claude (Anthropic)
  - Gemini (Google)
  - æ–‡å¿ƒä¸€è¨€ï¼ˆç™¾åº¦ï¼‰
- **é¢˜ç›®è®²è§£**: AI æ™ºèƒ½è®²è§£é¢˜ç›®
- **è¯­éŸ³æœ—è¯»**: TTS æ–‡å­—è½¬è¯­éŸ³åŠŸèƒ½ï¼ˆOpenAIã€Geminiã€æ–‡å¿ƒä¸€è¨€æ”¯æŒï¼‰
- **å®æ“è¯„ä»·**: AI è¯„ä»·å®æ“é¢˜ç­”æ¡ˆ
- **è‡ªåŠ¨è¯„åˆ†**: ç®€ç­”é¢˜ AI è‡ªåŠ¨è¯„åˆ†ï¼Œæ”¯æŒä¸¥æ ¼ç¨‹åº¦å’Œå…³é”®è¯æƒé‡é…ç½®
- **API é…ç½®**: æ”¯æŒå…¨å±€å’Œä¸ªäºº API Keyï¼Œå­¦å‘˜é…ç½®ä¼˜å…ˆ

### 7. è®¨è®ºç¤¾åŒºæ¨¡å— âœ¨ æ–°å¢
- **è®¨è®ºå‘èµ·**: å­¦å‘˜å¯å‘èµ·è®¨è®ºï¼Œæ”¯æŒå…³è”é¢˜ç›®
- **è¯„è®ºç³»ç»Ÿ**: å¤šçº§è¯„è®ºï¼Œæ”¯æŒå›å¤
- **ç‚¹èµåŠŸèƒ½**: è®¨è®ºå’Œè¯„è®ºç‚¹èµ
- **ç®¡ç†åŠŸèƒ½**: ç½®é¡¶ã€éšè—ã€åˆ é™¤è®¨è®º
- **å¯Œæ–‡æœ¬ç¼–è¾‘**: æ”¯æŒå¯Œæ–‡æœ¬å†…å®¹ç¼–è¾‘

### 8. æ ‡ç­¾ç®¡ç†æ¨¡å— âœ¨ æ–°å¢
- **æ ‡ç­¾åˆ›å»º**: åˆ›å»ºé¢˜ç›®æ ‡ç­¾ï¼Œæ”¯æŒè‡ªå®šä¹‰é¢œè‰²
- **æ ‡ç­¾ç¼–è¾‘**: ä¿®æ”¹æ ‡ç­¾åç§°å’Œé¢œè‰²
- **æ ‡ç­¾åˆå¹¶**: åˆå¹¶é‡å¤æ ‡ç­¾
- **ä½¿ç”¨ç»Ÿè®¡**: æ˜¾ç¤ºæ ‡ç­¾ä½¿ç”¨æ¬¡æ•°

### 9. æ•°æ®ç»Ÿè®¡æ¨¡å—
- **å­¦å‘˜ç»Ÿè®¡**:
  - ç­”é¢˜æ•°é‡
  - æ­£ç¡®ç‡
  - é”™é¢˜æ•°é‡
  - æ¯æ—¥è¿›åº¦
  - åœ¨çº¿æ—¶é•¿
  - å­¦ä¹ è¶‹åŠ¿å›¾è¡¨
- **ç®¡ç†å‘˜ç»Ÿè®¡**:
  - é¢˜åº“ä½¿ç”¨æƒ…å†µ
  - è€ƒè¯•é€šè¿‡ç‡
  - å­¦å‘˜æ´»è·ƒåº¦
  - ç™»å½•æ—¥å¿—
  - æ•°æ®çœ‹æ¿å¯è§†åŒ–

### 10. ç³»ç»Ÿè®¾ç½®æ¨¡å— âœ¨ å…¨é¢å‡çº§
- **ä¸»é¢˜å®šåˆ¶**:
  - é¡µé¢æ ‡ç­¾æ ‡é¢˜
  - Logo æ ‡è¯†ï¼ˆå›¾æ ‡+æ–‡å­— æˆ– ä¸Šä¼ å›¾ç‰‡ï¼‰
  - ç™»å½•é¡µæ ‡è¯­ï¼ˆPCç«¯/ç§»åŠ¨ç«¯ï¼‰
- **å†…å®¹ç®¡ç†**:
  - é¦–é¡µæ»šåŠ¨å…¬å‘Š
  - è½®æ’­æ¨ªå¹…ç®¡ç†ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬è¯¦æƒ…ï¼‰
  - è§†é¢‘è¯¾ç¨‹ç®¡ç†
  - é¦–é¡µå¸ƒå±€é…ç½®
  - å¤šè¯­è¨€è®¾ç½®ï¼ˆé¢„ç•™ï¼‰
- **ç³»ç»Ÿå®‰å…¨**:
  - æ•°æ®ç»´æŠ¤ä¸ç¾å¤‡
  - ç®¡ç†å‘˜å¯†ç æ›´æ–°
  - æ•°æ®æ¸…ç†ï¼ˆé¢„ç•™ï¼‰
  - å¤‡ä»½è®¡åˆ’ï¼ˆé¢„ç•™ï¼‰
- **æ™ºèƒ½åŒ–é…ç½®**:
  - AI æ¨¡å‹é€‰æ‹©
  - è‡ªåŠ¨è¯„åˆ†è§„åˆ™
  - TTS è¯­éŸ³è®¾ç½®

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨

#### users (ç”¨æˆ·è¡¨)
```sql
- id: ç”¨æˆ·ID (ä¸»é”®)
- phone: æ‰‹æœºå· (å”¯ä¸€)
- password: å¯†ç  (bcrypt åŠ å¯†)
- role: è§’è‰² (ADMIN/STUDENT)
- realName: çœŸå®å§“å
- nickname: æ˜µç§°
- avatar: å¤´åƒURL
- className: ç­çº§
- permissions: ç®¡ç†å‘˜æƒé™ (JSON)
- studentPerms: å­¦å‘˜æƒé™ (JSON)
- allowedBankIds: å…è®¸è®¿é—®çš„é¢˜åº“ (JSON)
- deepseekApiKey: ä¸ªäºº AI API Key
- aiProvider: AI æœåŠ¡å•†é€‰æ‹©
- ttsSpeed: TTS è¯­é€Ÿ
- ttsVoice: TTS éŸ³è‰²
- ttsAutoPlay: TTS è‡ªåŠ¨æ’­æ”¾
- loginHistory: ç™»å½•å†å² (JSON)
- totalOnlineTime: æ€»åœ¨çº¿æ—¶é•¿ (ç§’)
- lastLogin: æœ€åç™»å½•æ—¶é—´
- customFields: è‡ªå®šä¹‰å­—æ®µ (JSON)
```

#### banks (é¢˜åº“è¡¨)
```sql
- id: é¢˜åº“ID (ä¸»é”®)
- name: é¢˜åº“åç§°
- category: åˆ†ç±»
- level: éš¾åº¦ç­‰çº§
- description: æè¿°
- questionCount: é¢˜ç›®æ•°é‡
- scoreConfig: åˆ†å€¼é…ç½® (JSON) - æ”¯æŒ5ç§é¢˜å‹
- usageCount: ä½¿ç”¨æ¬¡æ•°
```

#### questions (é¢˜ç›®è¡¨)
```sql
- id: é¢˜ç›®ID (ä¸»é”®)
- bankId: æ‰€å±é¢˜åº“ID
- type: é¢˜å‹ (SINGLE/MULTIPLE/JUDGE/FILL_IN_BLANK/SHORT_ANSWER)
- content: é¢˜ç›®å†…å®¹
- options: é€‰é¡¹ (JSON)
- answer: ç­”æ¡ˆ (JSON)
- explanation: è§£æ
- tags: æ ‡ç­¾IDåˆ—è¡¨ (JSON)
```

#### tags (æ ‡ç­¾è¡¨) âœ¨ æ–°å¢
```sql
- id: æ ‡ç­¾ID (ä¸»é”®)
- name: æ ‡ç­¾åç§° (å”¯ä¸€)
- color: æ ‡ç­¾é¢œè‰²
- createdAt: åˆ›å»ºæ—¶é—´
- usageCount: ä½¿ç”¨æ¬¡æ•°
```

#### exams (è€ƒè¯•è¡¨)
```sql
- id: è€ƒè¯•ID (ä¸»é”®)
- bankId: é¢˜åº“ID
- title: è€ƒè¯•æ ‡é¢˜
- duration: è€ƒè¯•æ—¶é•¿ (åˆ†é’Ÿ)
- totalScore: æ€»åˆ†
- passScore: åŠæ ¼åˆ†æ•°
- passScorePercent: åŠæ ¼ç™¾åˆ†æ¯”
- strategy: å‡ºé¢˜ç­–ç•¥
- selectedQuestionIds: é€‰ä¸­çš„é¢˜ç›® (JSON)
- status: çŠ¶æ€ (PENDING/PUBLISHED)
- isVisible: æ˜¯å¦å¯è§
- startTime: å¼€å§‹æ—¶é—´
- endTime: ç»“æŸæ—¶é—´
- singleCount: å•é€‰é¢˜æ•°é‡
- multipleCount: å¤šé€‰é¢˜æ•°é‡
- judgeCount: åˆ¤æ–­é¢˜æ•°é‡
- fillInBlankCount: å¡«ç©ºé¢˜æ•°é‡ âœ¨ æ–°å¢
- shortAnswerCount: ç®€ç­”é¢˜æ•°é‡ âœ¨ æ–°å¢
```

#### exam_history (è€ƒè¯•å†å²è¡¨)
```sql
- id: è®°å½•ID (ä¸»é”®)
- userId: ç”¨æˆ·ID
- examId: è€ƒè¯•ID
- examTitle: è€ƒè¯•æ ‡é¢˜
- score: å¾—åˆ†
- totalScore: æ€»åˆ†
- passScore: åŠæ ¼åˆ†æ•°
- timeUsed: ç”¨æ—¶ (ç§’)
- submitTime: æäº¤æ—¶é—´
- bankId: é¢˜åº“ID
- wrongQuestionIds: é”™é¢˜ID (JSON)
- userAnswers: ç”¨æˆ·ç­”æ¡ˆ (JSON)
- passed: æ˜¯å¦é€šè¿‡
- currentIndex: å½“å‰é¢˜ç›®ç´¢å¼•
- isFinished: æ˜¯å¦å®Œæˆ
- examConfig: è€ƒè¯•é…ç½® (JSON)
- orderedQuestionIds: é¢˜ç›®é¡ºåº (JSON)
```

#### practice_records (ç»ƒä¹ è®°å½•è¡¨)
```sql
- id: è®°å½•ID (ä¸»é”®)
- userId: ç”¨æˆ·ID
- bankId: é¢˜åº“ID
- bankName: é¢˜åº“åç§°
- type: ç»ƒä¹ ç±»å‹
- questionTypeFilter: é¢˜å‹è¿‡æ»¤
- mode: ç»ƒä¹ æ¨¡å¼
- count: é¢˜ç›®æ•°é‡
- date: æ—¥æœŸ
- currentIndex: å½“å‰ç´¢å¼•
- userAnswers: ç”¨æˆ·ç­”æ¡ˆ (JSON)
- isCustom: æ˜¯å¦è‡ªå®šä¹‰
```

#### srs_records (SRSå¤ä¹ è®°å½•è¡¨) âœ¨ æ–°å¢
```sql
- id: è®°å½•ID (ä¸»é”®)
- userId: ç”¨æˆ·ID
- questionId: é¢˜ç›®ID
- bankId: é¢˜åº“ID
- nextReviewDate: ä¸‹æ¬¡å¤ä¹ æ—¥æœŸ
- intervalDays: é—´éš”å¤©æ•°
- easeFactor: éš¾åº¦å› å­
- reviewCount: å¤ä¹ æ¬¡æ•°
- lastReviewDate: æœ€åå¤ä¹ æ—¥æœŸ
```

#### discussions (è®¨è®ºè¡¨) âœ¨ æ–°å¢
```sql
- id: è®¨è®ºID (ä¸»é”®)
- title: æ ‡é¢˜
- content: å†…å®¹
- authorId: ä½œè€…ID
- authorName: ä½œè€…åç§°
- questionId: å…³è”é¢˜ç›®ID
- createdAt: åˆ›å»ºæ—¶é—´
- updatedAt: æ›´æ–°æ—¶é—´
- lastActivityAt: æœ€åæ´»åŠ¨æ—¶é—´
- viewCount: æµè§ˆæ¬¡æ•°
- likeCount: ç‚¹èµæ•°
- commentCount: è¯„è®ºæ•°
- isPinned: æ˜¯å¦ç½®é¡¶
- isHidden: æ˜¯å¦éšè—
```

#### comments (è¯„è®ºè¡¨) âœ¨ æ–°å¢
```sql
- id: è¯„è®ºID (ä¸»é”®)
- discussionId: è®¨è®ºID
- parentId: çˆ¶è¯„è®ºID
- authorId: ä½œè€…ID
- authorName: ä½œè€…åç§°
- content: å†…å®¹
- createdAt: åˆ›å»ºæ—¶é—´
- likeCount: ç‚¹èµæ•°
```

#### discussion_likes (è®¨è®ºç‚¹èµè¡¨) âœ¨ æ–°å¢
```sql
- userId: ç”¨æˆ·ID (è”åˆä¸»é”®)
- discussionId: è®¨è®ºID (è”åˆä¸»é”®)
- createdAt: åˆ›å»ºæ—¶é—´
```

#### practical_tasks (å®æ“é¢˜è¡¨)
```sql
- id: ä»»åŠ¡ID (ä¸»é”®)
- title: æ ‡é¢˜
- parts: é¢˜ç›®éƒ¨åˆ† (JSON)
- createdAt: åˆ›å»ºæ—¶é—´
```

#### practical_records (å®æ“è®°å½•è¡¨)
```sql
- id: è®°å½•ID (ä¸»é”®)
- userId: ç”¨æˆ·ID
- taskId: ä»»åŠ¡ID
- answers: ç­”æ¡ˆ (JSON)
- submittedAt: æäº¤æ—¶é—´
```

#### mistakes (é”™é¢˜è¡¨)
```sql
- userId: ç”¨æˆ·ID (è”åˆä¸»é”®)
- questionId: é¢˜ç›®ID (è”åˆä¸»é”®)
```

#### favorites (æ”¶è—è¡¨)
```sql
- userId: ç”¨æˆ·ID (è”åˆä¸»é”®)
- questionId: é¢˜ç›®ID (è”åˆä¸»é”®)
```

#### notes (ç¬”è®°è¡¨)
```sql
- userId: ç”¨æˆ·ID (è”åˆä¸»é”®)
- questionId: é¢˜ç›®ID (è”åˆä¸»é”®)
- content: ç¬”è®°å†…å®¹
- updatedAt: æ›´æ–°æ—¶é—´
```

#### daily_progress (æ¯æ—¥è¿›åº¦è¡¨)
```sql
- id: è®°å½•ID (ä¸»é”®)
- userId: ç”¨æˆ·ID
- date: æ—¥æœŸ
- count: ç­”é¢˜æ•°é‡
```

#### system_config (ç³»ç»Ÿé…ç½®è¡¨)
```sql
- id: é…ç½®ID (ä¸»é”®)
- data: é…ç½®æ•°æ® (JSON)
  - pageTitle: é¡µé¢æ ‡é¢˜
  - logoIcon: Logoå›¾æ ‡
  - logoText: Logoæ–‡å­—
  - logoImage: Logoå›¾ç‰‡ (Base64)
  - loginSlogan: ç™»å½•é¡µæ ‡è¯­(PC)
  - loginSloganMobile: ç™»å½•é¡µæ ‡è¯­(ç§»åŠ¨)
  - announcement: å…¬å‘Šå†…å®¹
  - banners: æ¨ªå¹…åˆ—è¡¨
  - videos: è§†é¢‘åˆ—è¡¨
  - homeLayout: é¦–é¡µå¸ƒå±€é…ç½®
  - aiProvider: AIæœåŠ¡å•†
  - deepseekApiKey: å…¨å±€API Key
  - aiGradingStrictness: è¯„åˆ†ä¸¥æ ¼ç¨‹åº¦
  - keywordWeight: å…³é”®è¯æƒé‡
  - ttsSpeed: TTSè¯­é€Ÿ
  - ttsVoice: TTSéŸ³è‰²
  - ttsAutoPlay: TTSè‡ªåŠ¨æ’­æ”¾
```

#### custom_fields (è‡ªå®šä¹‰å­—æ®µè¡¨)
```sql
- id: å­—æ®µID (ä¸»é”®)
- name: å­—æ®µåç§°
- type: å­—æ®µç±»å‹
- options: é€‰é¡¹ (JSON)
- createdAt: åˆ›å»ºæ—¶é—´
```

## API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

#### POST /api/auth/login
ç™»å½•æ¥å£
- **è¯·æ±‚ä½“**:
  ```json
  {
    "phone": "admin",
    "password": "admin",
    "role": "ADMIN"
  }
  ```
- **å“åº”**:
  ```json
  {
    "token": "jwt_token",
    "user": { ...ç”¨æˆ·ä¿¡æ¯ }
  }
  ```

### ç”¨æˆ·æ¥å£

#### GET /api/user/profile
è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ (éœ€è¦è®¤è¯)

#### PUT /api/user/profile
æ›´æ–°ç”¨æˆ·ä¿¡æ¯ (éœ€è¦è®¤è¯)

#### POST /api/user/reset
é‡ç½®ç”¨æˆ·å­¦ä¹ æ•°æ® (éœ€è¦è®¤è¯)

### é¢˜åº“æ¥å£

#### GET /api/banks
è·å–æ‰€æœ‰é¢˜åº“ (éœ€è¦è®¤è¯)

#### POST /api/banks
åˆ›å»ºé¢˜åº“ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/banks/:id
æ›´æ–°é¢˜åº“ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/banks/:id
åˆ é™¤é¢˜åº“ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/banks/:id/score
æ›´æ–°é¢˜åº“åˆ†å€¼é…ç½® (éœ€è¦ç®¡ç†å‘˜æƒé™)

### é¢˜ç›®æ¥å£

#### GET /api/questions?bankId=xxx
è·å–é¢˜åº“çš„æ‰€æœ‰é¢˜ç›® (éœ€è¦è®¤è¯)

#### POST /api/questions
åˆ›å»ºé¢˜ç›® (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/questions/:id
æ›´æ–°é¢˜ç›® (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/questions/:id
åˆ é™¤é¢˜ç›® (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/questions/batch-delete
æ‰¹é‡åˆ é™¤é¢˜ç›® (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/banks/:id/import
æ‰¹é‡å¯¼å…¥é¢˜ç›® (éœ€è¦ç®¡ç†å‘˜æƒé™)

### æ ‡ç­¾æ¥å£ âœ¨ æ–°å¢

#### GET /api/tags
è·å–æ‰€æœ‰æ ‡ç­¾ (éœ€è¦è®¤è¯)

#### POST /api/tags
åˆ›å»ºæ ‡ç­¾ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/tags/:id
æ›´æ–°æ ‡ç­¾ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/tags/:id
åˆ é™¤æ ‡ç­¾ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/tags/merge
åˆå¹¶æ ‡ç­¾ (éœ€è¦ç®¡ç†å‘˜æƒé™)

### è€ƒè¯•æ¥å£

#### GET /api/exams
è·å–æ‰€æœ‰è€ƒè¯• (éœ€è¦è®¤è¯)

#### POST /api/exams
åˆ›å»ºè€ƒè¯• (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/exams/:id
æ›´æ–°è€ƒè¯• (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/exams/:id
åˆ é™¤è€ƒè¯• (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/exams/:id/visibility
åˆ‡æ¢è€ƒè¯•å¯è§æ€§ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### GET /api/exams/history
è·å–è€ƒè¯•å†å² (éœ€è¦è®¤è¯)

#### POST /api/exams/history
åˆ›å»º/æ›´æ–°è€ƒè¯•å†å² (éœ€è¦è®¤è¯)

#### DELETE /api/exams/history/:id
åˆ é™¤è€ƒè¯•å†å² (éœ€è¦è®¤è¯)

### ç»ƒä¹ æ¥å£

#### GET /api/practice
è·å–ç»ƒä¹ è®°å½• (éœ€è¦è®¤è¯)

#### POST /api/practice
åˆ›å»ºç»ƒä¹ è®°å½• (éœ€è¦è®¤è¯)

#### PUT /api/practice/:id
æ›´æ–°ç»ƒä¹ è¿›åº¦ (éœ€è¦è®¤è¯)

#### DELETE /api/practice/:id
åˆ é™¤ç»ƒä¹ è®°å½• (éœ€è¦è®¤è¯)

### SRSå¤ä¹ æ¥å£ âœ¨ æ–°å¢

#### GET /api/srs/due
è·å–ä»Šæ—¥å¾…å¤ä¹ é¢˜ç›® (éœ€è¦è®¤è¯)

#### POST /api/srs/update
æ›´æ–°SRSè®°å½• (éœ€è¦è®¤è¯)

### é”™é¢˜ä¸æ”¶è—æ¥å£

#### GET /api/mistakes
è·å–é”™é¢˜ (éœ€è¦è®¤è¯)

#### POST /api/mistakes
æ·»åŠ é”™é¢˜ (éœ€è¦è®¤è¯)

#### DELETE /api/mistakes/:qId
åˆ é™¤é”™é¢˜ (éœ€è¦è®¤è¯)

#### GET /api/favorites
è·å–æ”¶è—é¢˜ç›® (éœ€è¦è®¤è¯)

#### POST /api/favorites/:qId
åˆ‡æ¢æ”¶è—çŠ¶æ€ (éœ€è¦è®¤è¯)

### ç¬”è®°æ¥å£

#### GET /api/notes/:qId
è·å–é¢˜ç›®ç¬”è®° (éœ€è¦è®¤è¯)

#### POST /api/notes
ä¿å­˜/åˆ é™¤ç¬”è®° (éœ€è¦è®¤è¯)

### è®¨è®ºæ¥å£ âœ¨ æ–°å¢

#### GET /api/discussions
è·å–è®¨è®ºåˆ—è¡¨ (éœ€è¦è®¤è¯)

#### GET /api/discussions/:id
è·å–è®¨è®ºè¯¦æƒ… (éœ€è¦è®¤è¯)

#### POST /api/discussions
åˆ›å»ºè®¨è®º (éœ€è¦è®¤è¯)

#### PUT /api/discussions/:id
æ›´æ–°è®¨è®º (éœ€è¦è®¤è¯)

#### DELETE /api/discussions/:id
åˆ é™¤è®¨è®º (éœ€è¦è®¤è¯)

#### PUT /api/discussions/:id/pin
åˆ‡æ¢è®¨è®ºç½®é¡¶ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/discussions/:id/visibility
åˆ‡æ¢è®¨è®ºå¯è§æ€§ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/discussions/:id/like
åˆ‡æ¢è®¨è®ºç‚¹èµ (éœ€è¦è®¤è¯)

### è¯„è®ºæ¥å£ âœ¨ æ–°å¢

#### GET /api/comments?discussionId=xxx
è·å–è¯„è®ºåˆ—è¡¨ (éœ€è¦è®¤è¯)

#### POST /api/comments
åˆ›å»ºè¯„è®º (éœ€è¦è®¤è¯)

#### DELETE /api/comments/:id
åˆ é™¤è¯„è®º (éœ€è¦è®¤è¯)

#### POST /api/comments/:id/like
åˆ‡æ¢è¯„è®ºç‚¹èµ (éœ€è¦è®¤è¯)

### AI æ¥å£

#### POST /api/ai/generate
AI ç”Ÿæˆå†…å®¹ (éœ€è¦è®¤è¯)
- **è¯·æ±‚ä½“**:
  ```json
  {
    "prompt": "è¯·è®²è§£è¿™é“é¢˜...",
    "apiKey": "å¯é€‰çš„ä¸ªäººAPI Key"
  }
  ```

### å®æ“é¢˜æ¥å£

#### GET /api/practical/tasks
è·å–å®æ“é¢˜åˆ—è¡¨ (éœ€è¦è®¤è¯)

#### POST /api/practical/tasks
åˆ›å»ºå®æ“é¢˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/practical/tasks/:id
æ›´æ–°å®æ“é¢˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/practical/tasks/:id
åˆ é™¤å®æ“é¢˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### GET /api/practical/records
è·å–å®æ“è®°å½• (éœ€è¦è®¤è¯)

#### POST /api/practical/records
æäº¤å®æ“ç­”æ¡ˆ (éœ€è¦è®¤è¯)

### ç®¡ç†å‘˜æ¥å£

#### GET /api/admin/students
è·å–æ‰€æœ‰å­¦å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/admin/students
åˆ›å»ºå­¦å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/admin/students/:id
æ›´æ–°å­¦å‘˜ä¿¡æ¯ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/admin/students/batch-delete
æ‰¹é‡åˆ é™¤å­¦å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/admin/students/batch-perms
æ‰¹é‡è®¾ç½®å­¦å‘˜æƒé™ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/admin/students/:id/perms
æ›´æ–°å­¦å‘˜æƒé™ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### GET /api/admin/admins
è·å–æ‰€æœ‰ç®¡ç†å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/admin/admins
åˆ›å»ºç®¡ç†å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### PUT /api/admin/admins/:id
æ›´æ–°ç®¡ç†å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/admin/admins/:id
åˆ é™¤ç®¡ç†å‘˜ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### GET /api/admin/login-logs
è·å–ç™»å½•æ—¥å¿— (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/admin/change-password
ä¿®æ”¹ç®¡ç†å‘˜å¯†ç  (éœ€è¦ç®¡ç†å‘˜æƒé™)

### ç³»ç»Ÿé…ç½®æ¥å£

#### GET /api/config
è·å–ç³»ç»Ÿé…ç½® (å…¬å¼€æ¥å£)

#### PUT /api/config
æ›´æ–°ç³»ç»Ÿé…ç½® (éœ€è¦ç®¡ç†å‘˜æƒé™)

### æ•°æ®å¯¼å…¥å¯¼å‡ºæ¥å£

#### POST /api/data/export
å¯¼å‡ºå…¨ç«™æ•°æ® (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/data/import
å¯¼å…¥æ•°æ® (éœ€è¦ç®¡ç†å‘˜æƒé™)

### è‡ªå®šä¹‰å­—æ®µæ¥å£

#### GET /api/custom-fields
è·å–è‡ªå®šä¹‰å­—æ®µ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### POST /api/custom-fields
åˆ›å»ºè‡ªå®šä¹‰å­—æ®µ (éœ€è¦ç®¡ç†å‘˜æƒé™)

#### DELETE /api/custom-fields/:id
åˆ é™¤è‡ªå®šä¹‰å­—æ®µ (éœ€è¦ç®¡ç†å‘˜æƒé™)

## ç¯å¢ƒé…ç½®

### ç¯å¢ƒå˜é‡ (.env)
```bash
# JWT Secret (ç”¨äºç”¨æˆ·è®¤è¯)
JWT_SECRET=edumaster-secure-production-2025-jingtianairen

# Server Port (åç«¯æœåŠ¡ç«¯å£)
PORT=3001

# DeepSeek API Key (å¯é€‰ï¼Œå¯åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®)
DEEPSEEK_API_KEY=

# Node Environment
NODE_ENV=production
```

### PM2 é…ç½® (ecosystem.config.cjs)
```javascript
module.exports = {
  apps: [{
    name: 'edumaster-api',
    script: './server.js',
    instances: 1,
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    watch: false,
    max_memory_restart: '500M'
  }]
};
```

### Nginx é…ç½®
```nginx
server {
    listen 80;
    server_name jingtianairen.cc www.jingtianairen.cc;

    root /var/www/edumaster/dist;
    index index.html;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆç”¨äºAIè¯·æ±‚ï¼‰
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
}
```

## å®‰å…¨ç‰¹æ€§

### 1. è®¤è¯ä¸æˆæƒ
- JWT Token è®¤è¯
- 7å¤© Token æœ‰æ•ˆæœŸ
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ (RBAC)
- å¯†ç  bcrypt åŠ å¯† (10 è½®)
- å¤šæ ‡ç­¾é¡µç™»å½•çŠ¶æ€åŒæ­¥
- è‡ªåŠ¨ç™»å‡ºæœºåˆ¶

### 2. API å®‰å…¨
- CORS è·¨åŸŸä¿æŠ¤
- è¯·æ±‚ä½“å¤§å°é™åˆ¶ (50MB)
- SQL æ³¨å…¥é˜²æŠ¤ (å‚æ•°åŒ–æŸ¥è¯¢)
- XSS é˜²æŠ¤ (å‰ç«¯è¾“å…¥éªŒè¯)
- è®¤è¯ä¸­é—´ä»¶ä¿æŠ¤æ‰€æœ‰æ•æ„Ÿæ¥å£
- æƒé™éªŒè¯ï¼ˆç®¡ç†å‘˜/å­¦å‘˜ï¼‰

### 3. æ•°æ®å®‰å…¨
- å¯†ç ä¸å¯é€†åŠ å¯†
- æ•æ„Ÿä¿¡æ¯ä¸è¿”å›å‰ç«¯
- æ•°æ®åº“æ–‡ä»¶æƒé™æ§åˆ¶
- æ”¯æŒæ•°æ®å¯¼å‡ºå¤‡ä»½
- ç”¨æˆ·æ•°æ®é‡ç½®åŠŸèƒ½
- API Key åŠ å¯†å­˜å‚¨

### 4. ç½‘ç»œå®‰å…¨
- Nginx åå‘ä»£ç†
- å®‰å…¨å“åº”å¤´é…ç½®
- HTTPS æ”¯æŒ (éœ€é…ç½® SSL)
- é˜²æ­¢æš´åŠ›ç ´è§£ï¼ˆå»ºè®®æ·»åŠ é™æµï¼‰

### 5. å†…å®¹å®‰å…¨
- å¯Œæ–‡æœ¬å†…å®¹è¿‡æ»¤
- æ–‡ä»¶ä¸Šä¼ éªŒè¯ï¼ˆå›¾ç‰‡å¤§å°ã€æ ¼å¼ï¼‰
- Base64 å›¾ç‰‡å­˜å‚¨ï¼ˆLogoã€æ¨ªå¹…ï¼‰

## æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–
- Vite æ„å»ºä¼˜åŒ–
- ä»£ç åˆ†å‰²ï¼ˆæŒ‰è·¯ç”±ï¼‰
- é™æ€èµ„æºç¼“å­˜ (1å¹´)
- Gzip å‹ç¼©
- å›¾ç‰‡æ‡’åŠ è½½
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§åˆ—è¡¨ï¼‰
- é˜²æŠ–èŠ‚æµï¼ˆæœç´¢ã€è¾“å…¥ï¼‰

### 2. åç«¯ä¼˜åŒ–
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- JSON å­—æ®µç¼“å­˜
- PM2 é›†ç¾¤æ¨¡å¼
- å†…å­˜é™åˆ¶ (500MB)
- è¿æ¥æ± ç®¡ç†
- æŸ¥è¯¢ç»“æœç¼“å­˜

### 3. æ•°æ®åº“ä¼˜åŒ–
- SQLite WAL æ¨¡å¼ (å»ºè®®å¯ç”¨)
- å®šæœŸ VACUUM
- åˆç†çš„ç´¢å¼•è®¾è®¡
- å¤–é”®çº¦æŸ
- äº‹åŠ¡å¤„ç†

### 4. AI è¯·æ±‚ä¼˜åŒ–
- æ”¯æŒå¤šä¸ª AI æœåŠ¡å•†
- ä¸ªäºº API Key ä¼˜å…ˆ
- è¯·æ±‚è¶…æ—¶è®¾ç½®
- é”™è¯¯é‡è¯•æœºåˆ¶

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—æ–‡ä»¶
- **æ ‡å‡†è¾“å‡º**: `/var/www/edumaster/logs/out.log`
- **é”™è¯¯æ—¥å¿—**: `/var/www/edumaster/logs/err.log`
- **Nginx è®¿é—®æ—¥å¿—**: `/var/log/nginx/edumaster_access.log`
- **Nginx é”™è¯¯æ—¥å¿—**: `/var/log/nginx/edumaster_error.log`

### PM2 ç›‘æ§å‘½ä»¤
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs edumaster-api

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
pm2 logs edumaster-api --lines 100

# ç›‘æ§èµ„æºä½¿ç”¨
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show edumaster-api
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/www/edumaster/logs/err.log

# ç»Ÿè®¡ API è¯·æ±‚
grep "POST\|GET\|PUT\|DELETE" /var/log/nginx/edumaster_access.log | wc -l

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
tail -100 /var/log/nginx/edumaster_error.log
```

## å¤‡ä»½ç­–ç•¥

### æ•°æ®åº“å¤‡ä»½
```bash
# æ‰‹åŠ¨å¤‡ä»½
cp /var/www/edumaster/edumaster.db /var/www/edumaster/backups/edumaster_$(date +%Y%m%d_%H%M%S).db

# å®šæ—¶å¤‡ä»½ (crontab)
0 2 * * * cp /var/www/edumaster/edumaster.db /var/www/edumaster/backups/edumaster_$(date +\%Y\%m\%d).db

# ä¿ç•™æœ€è¿‘ 7 å¤©çš„å¤‡ä»½
0 3 * * * find /var/www/edumaster/backups -name "edumaster_*.db" -mtime +7 -delete
```

### ä»£ç å¤‡ä»½
- ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶
- å®šæœŸæ¨é€åˆ°è¿œç¨‹ä»“åº“
- ä¿ç•™éƒ¨ç½²å‰çš„ä»£ç å¿«ç…§
- æ ‡è®°é‡è¦ç‰ˆæœ¬ (Git Tag)

### é…ç½®å¤‡ä»½
```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf config_backup_$(date +%Y%m%d).tar.gz .env ecosystem.config.cjs /etc/nginx/sites-available/edumaster
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3001

# æŸ¥çœ‹ PM2 æ—¥å¿—
pm2 logs edumaster-api --err

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la /var/www/edumaster/edumaster.db

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat /var/www/edumaster/.env

# æµ‹è¯• Node.js ç‰ˆæœ¬
node --version
```

#### 2. å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
systemctl status nginx

# æµ‹è¯• Nginx é…ç½®
nginx -t

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/edumaster_error.log

# æ£€æŸ¥é™æ€æ–‡ä»¶
ls -la /var/www/edumaster/dist

# é‡å¯ Nginx
systemctl restart nginx
```

#### 3. API è¯·æ±‚å¤±è´¥
```bash
# æµ‹è¯•åç«¯ API
curl http://localhost:3001/api/config

# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 status

# é‡å¯æœåŠ¡
pm2 restart edumaster-api

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs edumaster-api --lines 50
```

#### 4. æ•°æ®åº“é”™è¯¯
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
sqlite3 /var/www/edumaster/edumaster.db ".tables"

# æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 /var/www/edumaster/edumaster.db "PRAGMA integrity_check;"

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
ls -lh /var/www/edumaster/edumaster.db

# ä¼˜åŒ–æ•°æ®åº“
sqlite3 /var/www/edumaster/edumaster.db "VACUUM;"
```

#### 5. AI åŠŸèƒ½å¼‚å¸¸
```bash
# æ£€æŸ¥ API Key é…ç½®
# åœ¨ç³»ç»Ÿè®¾ç½®ä¸­éªŒè¯ API Key

# æµ‹è¯• AI æ¥å£
curl -X POST http://localhost:3001/api/ai/generate \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"prompt":"æµ‹è¯•"}'

# æŸ¥çœ‹ AI ç›¸å…³é”™è¯¯æ—¥å¿—
grep "AI\|DeepSeek\|OpenAI" /var/www/edumaster/logs/err.log
```

#### 6. ç™»å½•é—®é¢˜
```bash
# æ£€æŸ¥ JWT Secret
grep JWT_SECRET /var/www/edumaster/.env

# æµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"admin","password":"admin","role":"ADMIN"}'

# æŸ¥çœ‹è®¤è¯ç›¸å…³æ—¥å¿—
grep "login\|auth" /var/www/edumaster/logs/out.log
```

### æ€§èƒ½é—®é¢˜æ’æŸ¥

#### 1. å“åº”æ…¢
```bash
# æ£€æŸ¥æœåŠ¡å™¨èµ„æº
top
htop
free -h
df -h

# æ£€æŸ¥æ•°æ®åº“å¤§å°
du -sh /var/www/edumaster/edumaster.db

# åˆ†ææ…¢æŸ¥è¯¢ï¼ˆéœ€è¦å¯ç”¨æ—¥å¿—ï¼‰
grep "slow" /var/www/edumaster/logs/out.log
```

#### 2. å†…å­˜å ç”¨é«˜
```bash
# æŸ¥çœ‹ PM2 å†…å­˜ä½¿ç”¨
pm2 monit

# é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜
pm2 restart edumaster-api

# è°ƒæ•´ PM2 å†…å­˜é™åˆ¶
# ç¼–è¾‘ ecosystem.config.cjs ä¸­çš„ max_memory_restart
```

## å‡çº§ä¸ç»´æŠ¤

### ä»£ç æ›´æ–°æµç¨‹
1. **æœ¬åœ°æ„å»ºæ–°ç‰ˆæœ¬**
   ```bash
   npm run build
   ```

2. **å¤‡ä»½æœåŠ¡å™¨æ•°æ®**
   ```bash
   ssh root@server "cp /var/www/edumaster/edumaster.db /var/www/edumaster/backups/edumaster_$(date +%Y%m%d_%H%M%S).db"
   ```

3. **ä¸Šä¼ æ–°æ–‡ä»¶åˆ°æœåŠ¡å™¨**
   ```bash
   scp -r dist/* root@server:/var/www/edumaster/dist/
   scp server.js root@server:/var/www/edumaster/
   scp package.json root@server:/var/www/edumaster/
   ```

4. **å®‰è£…æ–°ä¾èµ–ï¼ˆå¦‚æœ‰ï¼‰**
   ```bash
   ssh root@server "cd /var/www/edumaster && npm install"
   ```

5. **é‡å¯ PM2 æœåŠ¡**
   ```bash
   ssh root@server "pm2 restart edumaster-api"
   ```

6. **é‡è½½ Nginx é…ç½®ï¼ˆå¦‚æœ‰ä¿®æ”¹ï¼‰**
   ```bash
   ssh root@server "nginx -t && systemctl reload nginx"
   ```

7. **éªŒè¯åŠŸèƒ½æ­£å¸¸**
   - è®¿é—®ç½‘ç«™æ£€æŸ¥å‰ç«¯
   - æµ‹è¯•ç™»å½•åŠŸèƒ½
   - æ£€æŸ¥ API å“åº”
   - æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ— é”™è¯¯

### ä¾èµ–æ›´æ–°
```bash
# æ£€æŸ¥è¿‡æ—¶çš„ä¾èµ–
npm outdated

# æ›´æ–°ä¾èµ–
npm update

# æ›´æ–°ç‰¹å®šåŒ…
npm install package-name@latest

# é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
rm -rf node_modules package-lock.json
npm install
```

### æ•°æ®åº“è¿ç§»
```bash
# å¯¼å‡ºæ•°æ®
sqlite3 edumaster.db .dump > backup.sql

# å¯¼å…¥åˆ°æ–°æ•°æ®åº“
sqlite3 new_edumaster.db < backup.sql

# æˆ–ä½¿ç”¨ cp å‘½ä»¤
cp edumaster.db edumaster_new.db
```

## æ‰©å±•å»ºè®®

### 1. åŠŸèƒ½æ‰©å±•
- âœ… å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜æ”¯æŒ
- âœ… é¢˜ç›®æ ‡ç­¾ç³»ç»Ÿ
- âœ… è®¨è®ºç¤¾åŒºåŠŸèƒ½
- âœ… SRS æ™ºèƒ½å¤ä¹ ç®—æ³•
- âœ… å¤š AI æœåŠ¡å•†æ”¯æŒ
- âœ… å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- â³ å­¦ä¹ è·¯å¾„è§„åˆ’
- â³ æˆå°±ç³»ç»Ÿå’Œå¾½ç« 
- â³ å­¦ä¹ å°ç»„åŠŸèƒ½
- â³ é¢˜ç›®æ¨èç®—æ³•
- â³ ç§»åŠ¨ç«¯ APP

### 2. æ€§èƒ½æ‰©å±•
- â³ è¿ç§»åˆ° PostgreSQL/MySQL
- â³ å®ç° Redis ç¼“å­˜
- â³ ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº
- â³ å®ç°è´Ÿè½½å‡è¡¡
- â³ æ•°æ®åº“è¯»å†™åˆ†ç¦»
- â³ å¾®æœåŠ¡æ¶æ„

### 3. å®‰å…¨æ‰©å±•
- â³ é…ç½® HTTPS (Let's Encrypt)
- â³ å®ç° API é™æµ
- â³ æ·»åŠ éªŒè¯ç åŠŸèƒ½
- â³ å®ç°å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- â³ åŒå› ç´ è®¤è¯ (2FA)
- â³ å†…å®¹å®‰å…¨è¿‡æ»¤

### 4. è¿ç»´æ‰©å±•
- â³ å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½² (CI/CD)
- â³ é…ç½®ç›‘æ§å‘Šè­¦ (Prometheus + Grafana)
- â³ å®ç°è‡ªåŠ¨å¤‡ä»½è„šæœ¬
- â³ é…ç½®æ—¥å¿—åˆ†æç³»ç»Ÿ (ELK)
- â³ å®¹å™¨åŒ–éƒ¨ç½² (Docker)
- â³ Kubernetes ç¼–æ’

### 5. ç”¨æˆ·ä½“éªŒæ‰©å±•
- âœ… ä¸»é¢˜å®šåˆ¶åŠŸèƒ½
- âœ… Logo è‡ªå®šä¹‰ä¸Šä¼ 
- â³ æ·±è‰²æ¨¡å¼æ”¯æŒ
- â³ å¤šè¯­è¨€å›½é™…åŒ–
- â³ æ— éšœç¢è®¿é—®ä¼˜åŒ–
- â³ PWA æ”¯æŒ

## æŠ€æœ¯æ”¯æŒ

### é»˜è®¤ç®¡ç†å‘˜è´¦å·
- **è´¦å·**: admin
- **å¯†ç **: admin
- **è§’è‰²**: è¶…çº§ç®¡ç†å‘˜

### é‡è¦æç¤º
1. âš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç 
2. ğŸ“¦ å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶ï¼ˆå»ºè®®æ¯å¤©ï¼‰
3. ğŸ“Š ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ
4. ğŸ”„ åŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…
5. ğŸ”’ é…ç½® HTTPS ä»¥æé«˜å®‰å…¨æ€§
6. ğŸ”‘ å¦¥å–„ä¿ç®¡ API Key å’Œ JWT Secret
7. ğŸ“ å®šæœŸæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
8. ğŸ§ª åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### ç³»ç»Ÿè¦æ±‚
- **æœåŠ¡å™¨**: 2æ ¸ CPU, 2GB RAM, 20GB å­˜å‚¨ï¼ˆæœ€ä½é…ç½®ï¼‰
- **æ¨è**: 4æ ¸ CPU, 4GB RAM, 50GB å­˜å‚¨
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 7+ / Debian 10+
- **Node.js**: 16.0.0+
- **æ•°æ®åº“**: SQLite 3.x

### è”ç³»æ–¹å¼
- **é¡¹ç›®åœ°å€**: http://jingtianairen.cc
- **æŠ€æœ¯æ–‡æ¡£**: æœ¬æ–‡æ¡£
- **é—®é¢˜åé¦ˆ**: é€šè¿‡ç³»ç»Ÿç®¡ç†å‘˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2026-01-09  
**ç»´æŠ¤è€…**: EduMaster å¼€å‘å›¢é˜Ÿ

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2026-01-09)
- âœ¨ æ–°å¢å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜æ”¯æŒ
- âœ¨ æ–°å¢é¢˜ç›®æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ
- âœ¨ æ–°å¢è®¨è®ºç¤¾åŒºåŠŸèƒ½
- âœ¨ æ–°å¢ SRS æ™ºèƒ½å¤ä¹ ç®—æ³•
- âœ¨ æ–°å¢å¤š AI æœåŠ¡å•†æ”¯æŒï¼ˆ5ä¸ªï¼‰
- âœ¨ æ–°å¢å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- âœ¨ æ–°å¢ä¸»é¢˜å®šåˆ¶åŠŸèƒ½
- âœ¨ æ–°å¢ Logo è‡ªå®šä¹‰ä¸Šä¼ 
- âœ¨ æ–°å¢ç³»ç»Ÿè®¾ç½®åˆ†ç±»ç®¡ç†
- âœ¨ æ–°å¢ç”¨æˆ·æ•°æ®é‡ç½®åŠŸèƒ½
- âœ¨ æ–°å¢è‡ªå®šä¹‰å­—æ®µåŠŸèƒ½
- ğŸ”§ ä¼˜åŒ–æƒé™ç®¡ç†ç³»ç»Ÿ
- ğŸ”§ ä¼˜åŒ–ç»ƒä¹ æ¨¡å¼äº¤äº’
- ğŸ”§ ä¼˜åŒ–ç§»åŠ¨ç«¯é€‚é…
- ğŸ› ä¿®å¤å¤šä¸ªå·²çŸ¥é—®é¢˜

### v1.0.0 (2026-01-07)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ åŸºç¡€é¢˜åº“ç®¡ç†åŠŸèƒ½
- âœ¨ ç»ƒä¹ å’Œè€ƒè¯•åŠŸèƒ½
- âœ¨ å®æ“é¢˜åŠŸèƒ½
- âœ¨ AI è®²è§£åŠŸèƒ½
- âœ¨ ç”¨æˆ·æƒé™ç®¡ç†
