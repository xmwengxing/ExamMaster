# 题库管理 - 填空题和简答题集成测试指南

## 概述

本文档提供了在题库管理界面中测试填空题和简答题创建、编辑和显示功能的详细步骤。

## 前置条件

1. 后端服务器运行在 `localhost:3001`
2. 前端开发服务器已启动
3. 已登录管理员账号
4. 至少有一个题库可用

## 测试场景

### 场景 1：创建填空题

#### 步骤：

1. **进入题库管理**
   - 导航到"题库管理"页面
   - 点击任意题库的"内容管理"按钮

2. **打开新增题目对话框**
   - 点击"新增题目"按钮
   - 验证对话框打开

3. **选择填空题类型**
   - 在"题目类型"下拉框中选择"填空题"
   - 验证"正确答案"输入框消失
   - 验证"候选项配置"区域消失
   - 验证"填空配置"区域出现

4. **填写题目内容**
   - 在"题目正文"中输入：
     ```
     {{blank1}} 是一种用于网页开发的脚本语言，而 {{blank2}} 是一个流行的 JavaScript 运行时环境。
     ```

5. **配置第一个空白**
   - 验证默认没有空白配置
   - 点击"添加空白"按钮
   - 在"空白 #1 (blank1)"的文本框中输入（每行一个答案）：
     ```
     JavaScript
     JS
     javascript
     ```
   - 不勾选"区分大小写"

6. **配置第二个空白**
   - 再次点击"添加空白"按钮
   - 在"空白 #2 (blank2)"的文本框中输入：
     ```
     Node.js
     NodeJS
     Node
     ```

7. **填写解析（可选）**
   - 在"专家解析"中输入：
     ```
     JavaScript 是前端开发的核心语言，Node.js 让 JavaScript 可以在服务器端运行。
     ```

8. **保存题目**
   - 点击"确认保存题目"按钮
   - 验证对话框关闭
   - 验证题目出现在列表中

9. **验证题目显示**
   - 在题目列表中找到刚创建的填空题
   - 验证题型标签显示"FILL_IN_BLANK"
   - 验证显示"2个空白"徽章
   - 验证显示空白答案预览：
     ```
     空白答案：blank1: JavaScript, JS... blank2: Node.js, NodeJS...
     ```

#### 预期结果：
- ✅ 填空题成功创建
- ✅ 题目列表正确显示填空题信息
- ✅ 空白配置正确保存

---

### 场景 2：编辑填空题

#### 步骤：

1. **打开编辑对话框**
   - 在题目列表中找到刚创建的填空题
   - 悬停在题目上，点击"编辑"按钮（笔图标）

2. **验证数据加载**
   - 验证题目类型显示为"填空题"
   - 验证题目内容正确显示
   - 验证两个空白配置都正确加载
   - 验证每个空白的答案列表正确显示

3. **修改空白配置**
   - 在"空白 #1"中添加新答案"js"
   - 勾选"区分大小写"复选框

4. **删除空白**
   - 点击"空白 #2"右上角的删除按钮
   - 验证空白被移除

5. **保存修改**
   - 点击"确认保存题目"
   - 验证修改成功

#### 预期结果：
- ✅ 填空题数据正确加载到编辑表单
- ✅ 空白配置可以修改
- ✅ 空白可以删除
- ✅ 修改成功保存

---

### 场景 3：创建简答题

#### 步骤：

1. **打开新增题目对话框**
   - 点击"新增题目"按钮

2. **选择简答题类型**
   - 在"题目类型"下拉框中选择"简答题"
   - 验证"正确答案"输入框消失
   - 验证"候选项配置"区域消失
   - 验证"参考答案"文本框出现
   - 验证"启用AI自动评分"复选框出现

3. **填写题目内容**
   - 在"题目正文"中输入：
     ```
     请简述 HTTPS 协议的工作原理，以及它如何保证数据传输的安全性。
     ```

4. **填写参考答案**
   - 在"参考答案"文本框中输入：
     ```
     HTTPS（超文本传输安全协议）是 HTTP 的安全版本，它通过以下方式保证数据传输安全：
     
     1. 使用 SSL/TLS 协议对数据进行加密，防止中间人窃听
     2. 通过数字证书验证服务器身份，防止钓鱼攻击
     3. 使用消息认证码（MAC）确保数据完整性，防止篡改
     
     具体流程包括：客户端与服务器建立 TLS 握手，协商加密算法和密钥，然后使用对称加密传输数据。
     ```

5. **启用AI评分**
   - 勾选"启用AI自动评分"复选框
   - 验证提示文字显示

6. **填写解析（可选）**
   - 在"专家解析"中输入相关说明

7. **保存题目**
   - 点击"确认保存题目"按钮
   - 验证对话框关闭

8. **验证题目显示**
   - 在题目列表中找到刚创建的简答题
   - 验证题型标签显示"SHORT_ANSWER"
   - 验证显示"AI评分"徽章
   - 验证显示参考答案预览（截断显示）

#### 预期结果：
- ✅ 简答题成功创建
- ✅ 参考答案正确保存
- ✅ AI评分标志正确保存
- ✅ 题目列表正确显示简答题信息

---

### 场景 4：编辑简答题

#### 步骤：

1. **打开编辑对话框**
   - 点击简答题的"编辑"按钮

2. **验证数据加载**
   - 验证题目类型显示为"简答题"
   - 验证题目内容正确显示
   - 验证参考答案正确显示
   - 验证"启用AI自动评分"复选框状态正确

3. **修改参考答案**
   - 在参考答案中添加更多内容

4. **关闭AI评分**
   - 取消勾选"启用AI自动评分"

5. **保存修改**
   - 点击"确认保存题目"
   - 验证修改成功
   - 验证"AI评分"徽章消失

#### 预期结果：
- ✅ 简答题数据正确加载
- ✅ 参考答案可以修改
- ✅ AI评分开关可以切换
- ✅ 修改成功保存

---

### 场景 5：题型筛选

#### 步骤：

1. **筛选填空题**
   - 在左侧筛选器中选择"填空题"
   - 验证只显示填空题
   - 验证页码重置为第1页

2. **筛选简答题**
   - 选择"简答题"
   - 验证只显示简答题

3. **显示全部题型**
   - 选择"全部题型"
   - 验证显示所有题目

#### 预期结果：
- ✅ 题型筛选功能正常工作
- ✅ 填空题和简答题可以被正确筛选

---

### 场景 6：验证错误处理

#### 测试 6.1：填空题缺少空白配置

1. 创建填空题，不添加任何空白
2. 点击"确认保存题目"
3. 验证显示错误提示："填空题至少需要配置一个空白"

#### 测试 6.2：填空题空白缺少答案

1. 创建填空题，添加一个空白但不填写答案
2. 点击"确认保存题目"
3. 验证显示错误提示："空白 blank1 至少需要一个可接受的答案"

#### 测试 6.3：简答题缺少参考答案

1. 创建简答题，不填写参考答案
2. 点击"确认保存题目"
3. 验证显示错误提示："简答题需要填写参考答案"

#### 预期结果：
- ✅ 所有验证规则正常工作
- ✅ 错误提示清晰明确

---

### 场景 7：题目删除

#### 步骤：

1. **删除填空题**
   - 悬停在填空题上
   - 点击删除按钮（垃圾桶图标）
   - 验证题目从列表中移除

2. **删除简答题**
   - 同样方式删除简答题
   - 验证删除成功

#### 预期结果：
- ✅ 填空题和简答题可以正常删除

---

## 数据验证

### 后端数据验证

可以通过以下方式验证数据是否正确保存到数据库：

1. **查看数据库**
   ```bash
   sqlite3 edumaster.db
   SELECT id, type, content, blanks, referenceAnswer, aiGradingEnabled FROM questions WHERE type IN ('FILL_IN_BLANK', 'SHORT_ANSWER');
   ```

2. **验证字段**
   - `blanks` 字段应包含 JSON 格式的空白配置数组
   - `referenceAnswer` 字段应包含参考答案文本
   - `aiGradingEnabled` 字段应为 0 或 1

### API 验证

可以使用浏览器开发者工具查看 API 请求：

1. **创建题目请求**
   - 端点：`POST /api/questions`
   - 验证请求体包含 `blanks` 或 `referenceAnswer` 字段

2. **更新题目请求**
   - 端点：`PUT /api/questions/:id`
   - 验证请求体正确包含修改后的数据

---

## 常见问题

### Q1: 填空题的占位符格式是什么？
A: 使用 `{{blank1}}`, `{{blank2}}` 等格式，其中 blank1, blank2 必须与空白配置中的 ID 对应。

### Q2: 填空题可以有多少个空白？
A: 理论上没有限制，但建议不超过 10 个以保证用户体验。

### Q3: 简答题的参考答案有长度限制吗？
A: 数据库字段为 TEXT 类型，可以存储大量文本，但建议参考答案控制在 1000 字以内。

### Q4: AI 评分功能在题库管理中可以测试吗？
A: 题库管理只负责配置是否启用 AI 评分，实际评分功能需要在练习模式中测试。

---

## 下一步

完成题库管理的测试后，可以继续测试：

1. **练习模式中的填空题** - 参考《填空题简答题测试指南.md》
2. **练习模式中的简答题** - 参考《填空题简答题测试指南.md》
3. **考试模式中的新题型** - 待实现

---

## 测试检查清单

- [ ] 场景 1：创建填空题
- [ ] 场景 2：编辑填空题
- [ ] 场景 3：创建简答题
- [ ] 场景 4：编辑简答题
- [ ] 场景 5：题型筛选
- [ ] 场景 6：验证错误处理
- [ ] 场景 7：题目删除
- [ ] 数据验证：数据库检查
- [ ] 数据验证：API 请求检查

---

**测试完成日期：** ___________

**测试人员：** ___________

**发现的问题：** ___________
