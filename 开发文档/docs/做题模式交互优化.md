# 做题模式交互优化

## 优化内容

### 1. 移动端左右滑动切换题目 ✅

**功能描述**：
- 在移动端做题时，支持左右滑动手势切换上下题
- 向左滑动：切换到下一题
- 向右滑动：切换到上一题
- 适用于所有做题模式（顺序练习、背题模式、模拟考试等）

**实现方式**：
- 使用React的触摸事件（`onTouchStart`, `onTouchMove`, `onTouchEnd`）
- 检测滑动距离（最小50px）和方向
- 自动触发上一题/下一题切换

**用户体验**：
- 更符合移动端操作习惯
- 单手操作更方便
- 提升做题流畅度

### 2. 点击/拖动任意位置显示左右箭头 ✅

**功能描述**：
- 点击或拖动页面任意位置（包括选项）时，浮现左右箭头按钮
- 箭头显示3秒后自动隐藏
- 左箭头：切换到上一题（第一题时禁用）
- 右箭头：切换到下一题

**实现方式**：
- 全局点击事件监听
- 定时器控制箭头显示/隐藏
- 半透明黑色背景，毛玻璃效果
- 固定在屏幕两侧

**用户体验**：
- 随时可以快速切换题目
- 不占用固定屏幕空间
- 视觉效果优雅

### 3. 按钮位置优化 ✅

**优化前**：
- "上一题"和"下一题"按钮固定在页面底部
- 需要滚动到底部才能操作
- 移动端操作不便

**优化后**：
- **顺序练习和背题模式**：按钮移到选项下方、AI解析上方
- **模拟考试、错题模式、智能复习**：保留底部按钮（因为这些模式通常需要查看解析）
- 按钮添加图标（左右箭头）
- 添加hover效果

**用户体验**：
- 做完题后立即可以切换，无需滚动
- 操作更便捷
- 视觉层次更清晰

## 技术实现

### 1. 触摸滑动检测

```typescript
// 触摸滑动相关状态
const [touchStart, setTouchStart] = useState<number | null>(null);
const [touchEnd, setTouchEnd] = useState<number | null>(null);

// 最小滑动距离
const minSwipeDistance = 50;

const onTouchStart = (e: React.TouchEvent) => {
  setTouchEnd(null);
  setTouchStart(e.targetTouches[0].clientX);
};

const onTouchMove = (e: React.TouchEvent) => {
  setTouchEnd(e.targetTouches[0].clientX);
};

const onTouchEnd = () => {
  if (!touchStart || !touchEnd) return;
  
  const distance = touchStart - touchEnd;
  const isLeftSwipe = distance > minSwipeDistance;
  const isRightSwipe = distance < -minSwipeDistance;
  
  if (isLeftSwipe && currentIndex < questions.length - 1) {
    handleNext();
  }
  if (isRightSwipe && currentIndex > 0) {
    handlePrev();
  }
};
```

### 2. 浮动箭头显示

```typescript
// 箭头显示状态
const [showArrows, setShowArrows] = useState(false);
const arrowTimerRef = useRef<number | null>(null);

const triggerArrows = useCallback(() => {
  setShowArrows(true);
  if (arrowTimerRef.current) window.clearTimeout(arrowTimerRef.current);
  arrowTimerRef.current = window.setTimeout(() => setShowArrows(false), 3000);
}, []);

// 全局点击监听
useEffect(() => {
  const handleGlobalClick = () => { triggerArrows(); };
  document.addEventListener('click', handleGlobalClick);
  return () => {
    document.removeEventListener('click', handleGlobalClick);
    if (arrowTimerRef.current) window.clearTimeout(arrowTimerRef.current);
  };
}, [triggerArrows]);
```

### 3. 条件渲染按钮

```typescript
{/* 选项下方的按钮 - 仅顺序练习和背题模式 */}
{!isMockMode && (isSequentialMode || isMemoryMode) && (
  <div className="mt-8 flex gap-4">
    <button onClick={handlePrev} disabled={currentIndex === 0}>
      <i className="fa-solid fa-chevron-left mr-2"></i>上一题
    </button>
    <button onClick={handleNext}>
      {currentIndex === questions.length - 1 ? '完成练习' : '下一题'}
      <i className="fa-solid fa-chevron-right ml-2"></i>
    </button>
  </div>
)}

{/* 底部按钮 - 模拟考试、错题模式、智能复习 */}
{(isMockMode || isMistakeMode || isSmartReviewMode) && (
  <div className="flex gap-4 p-4 md:p-0 relative z-10">
    {/* 按钮内容 */}
  </div>
)}
```

## 修改的文件

- `pages/Student/PracticeMode.tsx` - 做题模式组件

## 修改详情

### 1. 添加触摸滑动状态（第48-50行）

```typescript
const [touchStart, setTouchStart] = useState<number | null>(null);
const [touchEnd, setTouchEnd] = useState<number | null>(null);
```

### 2. 添加触摸事件处理函数（第330-350行）

```typescript
const onTouchStart = (e: React.TouchEvent) => { ... };
const onTouchMove = (e: React.TouchEvent) => { ... };
const onTouchEnd = () => { ... };
```

### 3. 主容器添加触摸事件监听（第380行）

```typescript
<div 
  className="..."
  onTouchStart={onTouchStart}
  onTouchMove={onTouchMove}
  onTouchEnd={onTouchEnd}
>
```

### 4. 选项下方添加按钮（第449-460行）

```typescript
{!isMockMode && (isSequentialMode || isMemoryMode) && (
  <div className="mt-8 flex gap-4">
    {/* 上一题/下一题按钮 */}
  </div>
)}
```

### 5. 优化底部按钮显示逻辑（第568-580行）

```typescript
{(isMockMode || isMistakeMode || isSmartReviewMode) && (
  <div className="flex gap-4 p-4 md:p-0 relative z-10">
    {/* 底部按钮 */}
  </div>
)}
```

## 测试步骤

### 1. 测试移动端滑动

1. 在移动设备或浏览器移动模式下打开应用
2. 进入任意做题模式（顺序练习、背题模式、模拟考试）
3. 在题目页面向左滑动
4. **验证**：切换到下一题
5. 向右滑动
6. **验证**：切换到上一题
7. 在第一题时向右滑动
8. **验证**：无反应（已到第一题）
9. 在最后一题时向左滑动
10. **验证**：显示完成提示或提交试卷

### 2. 测试浮动箭头

1. 进入做题模式
2. 点击页面任意位置（包括选项）
3. **验证**：左右箭头浮现
4. 等待3秒
5. **验证**：箭头自动隐藏
6. 点击左箭头
7. **验证**：切换到上一题
8. 点击右箭头
9. **验证**：切换到下一题
10. 在第一题时
11. **验证**：左箭头禁用（半透明）

### 3. 测试按钮位置

#### 顺序练习模式
1. 进入顺序练习
2. 选择一个选项
3. **验证**：选项下方立即显示"上一题"和"下一题"按钮
4. **验证**：页面底部没有按钮
5. 点击"下一题"
6. **验证**：切换成功

#### 背题模式
1. 进入背题模式
2. **验证**：选项下方显示"上一题"和"下一题"按钮
3. **验证**：页面底部没有按钮

#### 模拟考试模式
1. 进入模拟考试
2. **验证**：选项下方没有按钮
3. 滚动到页面底部
4. **验证**：底部显示"上一题"和"下一题"按钮

#### 错题模式
1. 进入错题练习
2. **验证**：底部显示按钮
3. **验证**：选项下方没有按钮

### 4. 测试响应式

1. 在桌面端测试
2. **验证**：所有功能正常
3. 在平板端测试
4. **验证**：滑动和按钮都正常
5. 在手机端测试
6. **验证**：滑动流畅，按钮大小合适

## 预期结果

✅ 移动端可以左右滑动切换题目  
✅ 滑动手势流畅自然  
✅ 点击任意位置显示箭头  
✅ 箭头3秒后自动隐藏  
✅ 顺序练习和背题模式按钮在选项下方  
✅ 模拟考试等模式按钮在底部  
✅ 按钮有图标和hover效果  
✅ 所有模式都能正常切换题目  
✅ 响应式设计良好  

## 用户反馈

### 优点
- 移动端操作更方便
- 单手做题更轻松
- 按钮位置更合理
- 视觉效果更好

### 注意事项
- 滑动时避免误触选项
- 箭头显示时间可根据用户反馈调整
- 不同模式的按钮位置需要适应

## 相关文档

- [HOME_LAYOUT_UPDATE.md](./HOME_LAYOUT_UPDATE.md) - 首页布局优化
- [DEBUGGING_GUIDE.md](./DEBUGGING_GUIDE.md) - 调试指南

---

**日期**：2026-01-07
